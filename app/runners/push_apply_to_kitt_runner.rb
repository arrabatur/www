class PushApplyToKittRunner
  def initialize(apply)
    @apply = apply
  end

  def run
    url = 'localhost:3001/applies'
    # url = 'https://kitt.lewagon.com/applies'
    # batches = {1=>["1", "paris", "2014-01-06"], 5=>["5", "paris", "2014-10-20"], 14=>["14", "-beirut", "2015-09-14"], 2=>["2", "paris", "2014-03-07"], 3=>["3", "paris", "2014-07-07"], 4=>["4", "paris", "2014-10-06"], 13=>["13", "lille", "2015-09-07"], 18=>["18", "paris", "2016-01-04"], 28=>["", "brussels", "2016-04-25"], 15=>["15", "paris", "2015-09-21"], 12=>["12", "brussels", "2015-08-17"], 11=>["11", "paris", "2015-07-13"], 7=>["7", "brussels", "2015-01-12"], 17=>["17", "brussels", "2015-10-19"], 31=>["20", "amsterdam", "2016-01-11"], 24=>["24", "paris", "2016-04-04"], 37=>["33", "copenhagen", "2016-07-04"], 22=>["32", "-beirut", "2016-07-04"], 53=>["42", "copenhagen", "2016-10-10"], 9=>["9", "brussels", "2015-05-04"], 38=>["36", "london", "2016-07-11"], 21=>["22", "lille", "2016-01-25"], 41=>["25", "amsterdam", "2016-04-11"], 8=>["8", "paris", "2015-03-09"], 36=>["27", "nantes", "2016-05-30"], 6=>["6", "paris", "2015-01-05"], 10=>["10", "paris", "2015-05-11"], 33=>["26", "lille", "2016-04-25"], 50=>["45", "brussels", "2016-10-17"], 58=>["50", "rio", "2017-01-09"], 16=>["16", "bordeaux", "2015-10-05"], 45=>["52", "lyon", "2017-01-09"], 29=>["29", "brussels", "2016-07-04"], 49=>["41", "london", "2016-10-03"], 27=>["35", "lille", "2016-07-04"], 54=>["44", "barcelona", "2016-10-17"], 44=>["38", "amsterdam", "2016-09-26"], 34=>["39", "lille", "2016-10-03"], 20=>["21", "aix-marseille", "2016-01-11"], 42=>["37", "aix-marseille", "2016-09-05"], 35=>["", "aix-marseille", "2016-05-02"], 56=>[nil, "belo-horizonte", "2017-12-04"], 23=>["23", "brussels", "2016-02-15"], 70=>["61", "shanghai", "2017-02-06"], 19=>["19", "bordeaux", "2016-01-11"], 32=>["31", "bordeaux", "2016-06-04"], 43=>["40", "bordeaux", "2016-10-03"], 51=>["51", "bordeaux", "2017-01-09"], 39=>["43", "paris", "2016-10-10"], 25=>["30", "paris", "2016-07-04"], 40=>["34", "sao-paulo", "2016-07-04"], 96=>["100", "paris", "2017-10-16"], 46=>["47", "nantes", "2016-10-17"], 71=>["64", "sao-paulo", "2017-03-06"], 65=>["60", "nantes", "2017-01-30"], 62=>["53", "aix-marseille", "2017-01-09"], 26=>["28", "lisbon", "2016-06-27"], 94=>["79", "nantes", "2017-06-05"], 101=>["109", "lyon", "2017-10-16"], 86=>["86", "lisbon", "2017-07-03"], 105=>["97", "lisbon", "2017-09-25"], 52=>["46", "sao-paulo", "2016-10-17"], 82=>["87", "lille", "2017-07-03"], 102=>["108", "lille", "2017-10-16"], 83=>["72", "lyon", "2017-04-10"], 74=>["63", "montreal", "2017-02-27"], 66=>["55", "copenhagen", "2017-01-09"], 64=>["91", "aix-marseille", "2017-07-03"], 90=>["77", "montreal", "2017-05-29"], 85=>["71", "lisbon", "2017-04-10"], 91=>["95", "barcelona", "2017-07-31"], 95=>["82", "lyon", "2017-06-26"], 73=>["68", "lille", "2017-04-10"], 99=>["78", "tokyo", "2017-05-29"], 104=>["90", "shanghai", "2017-07-03"], 47=>["48", "paris", "2017-01-02"], 92=>["81", "sao-paulo", "2017-06-26"], 87=>["69", "copenhagen", "2017-04-10"], 100=>["102", "bordeaux", "2017-10-02"], 103=>["111", "berlin", "2017-10-09"], 98=>["80", "amsterdam", "2017-06-26"], 77=>["74", "london", "2017-04-17"], 75=>["73", "brussels", "2017-04-17"], 60=>["56", "lille", "2017-01-16"], 69=>["62", "amsterdam", "2017-02-13"], 72=>["67", "bordeaux", "2017-04-03"], 55=>["49", "lisbon", "2017-01-09"], 115=>["113", "barcelona", "2017-10-23"], 123=>[nil, "lyon", "2018-01-08"], 121=>[nil, "bordeaux", "2018-01-08"], 130=>["101", "paris", "2017-10-16"], 109=>["", "copenhagen", "2017-07-03"], 68=>["59", "paris", "2017-01-30"], 93=>["89", "aix-marseille", "2017-10-16"], 120=>[nil, "lisbon", "2018-01-15"], 59=>["57", "barcelona", "2017-01-16"], 67=>["54", "london", "2017-01-09"], 131=>["123", "london", "2018-01-15"], 138=>["126", "amsterdam", "2018-01-15"], 119=>["112", "shanghai", "2017-10-09"], 125=>["114", "chengdu", "2017-10-16"], 110=>["104", "copenhagen", "2017-10-02"], 107=>["103", "london", "2017-10-02"], 78=>["83", "paris", "2017-07-03"], 81=>["58", "tokyo", "2017-02-27"], 79=>["65", "berlin", "2017-03-13"], 112=>["98", "montreal", "2017-09-25"], 126=>[nil, "tokyo", "2018-01-15"], 97=>["76", "shanghai", "2017-05-08"], 63=>["66", "aix-marseille", "2017-03-27"], 61=>["70", "paris", "2017-04-10"], 118=>["107", "nantes", "2017-10-16"], 114=>["110", "rio", "2017-10-09"], 141=>[nil, "aix-marseille", "2018-04-02"], 117=>["99", "amsterdam", "2017-10-02"], 129=>["130", "shanghai", "2018-02-26"], 127=>["120", "paris", "2018-01-08"], 122=>["118", "copenhagen", "2018-01-08"], 128=>["117", "aix-marseille", "2018-01-08"], 135=>[nil, "brussels", "2018-01-29"], 89=>["75", "barcelona", "2017-05-01"], 133=>[nil, "sao-paulo", "2018-02-19"], 132=>["128", "bali", "2018-01-15"], 136=>[nil, "milan", "2018-01-22"], 111=>["94", "tokyo", "2017-09-04"], 139=>["105", "lille", "2017-09-04"], 124=>["116", "lille", "2018-01-08"], 140=>["125", "montreal", "2018-01-15"], 84=>["92", "berlin", "2017-07-10"], 137=>["119", "budapest", "2018-01-08"], 142=>["124", "berlin", "2018-01-08"], 108=>["96", "brussels", "2017-09-25"], 143=>["129", "barcelona", "2018-01-22"], 134=>[nil, "rio", "2018-02-19"], 144=>[nil, "nantes", "2018-02-05"], 113=>["106", "sao-paulo", "2017-10-02"], 145=>[nil, "chengdu", "2018-03-05"], 146=>[nil, "brussels", "2018-04-30"], 147=>[nil, "sydney", "2018-02-05"], 149=>[nil, "melbourne", "2018-02-05"], 148=>[nil, "melbourne", "2018-04-30"], 88=>["93", "london", "2017-07-10"], 151=>[nil, "london", "2018-04-09"], 76=>["85", "bordeaux", "2017-07-03"], 106=>["88", "chengdu", "2017-07-03"], 80=>["84", "rio", "2017-07-03"], 152=>[nil, "bordeaux", "2018-04-02"], 153=>[nil, "paris", "2018-01-29"], 150=>[nil, "paris", "2018-04-09"], 154=>[nil, "recife", "2018-01-22"]}
    # london = { 38=>["36", "london", "2016-07-11"], 49=>["41", "london", "2016-10-03"], 77=>["74", "london", "2017-04-17"], 67=>["54", "london", "2017-01-09"], 131=>["123", "london", "2018-01-15"], 107=>["103", "london", "2017-10-02"], 88=>["93", "london", "2017-07-10"] }

    payload = {
      camp_slug: @apply.batch_id,
      apply: {
        email: @apply.email,
        first_name: @apply.first_name,
        last_name: @apply.last_name,
        codecademy_username: @apply.codecademy_username,
        linkedin: @apply.linkedin,
        age: @apply.age,
        phone_number: @apply.phone,
        source: @apply.source,
        motivation: @apply.motivation,
        price_cents: price_cents,
        price_currency: price_currency,
        created_at: @apply.created_at,
        updated_at: @apply.updated_at
      }
    }

    begin
      RestClient.post url, payload.to_json, content_type: :json, accept: :json
    rescue => e
      puts e
    end
  end

  private

  def price_cents
    Rails.env.production? ? @apply.batch.price.cents : 100000
  end

  def price_currency
    Rails.env.production? ? @apply.batch.price.currency.to_s : 'EUR'
  end
end
